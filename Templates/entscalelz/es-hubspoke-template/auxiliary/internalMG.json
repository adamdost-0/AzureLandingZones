{
    "$schema": "https://schema.management.azure.com/schemas/2019-08-01/tenantDeploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "topLevelManagementGroupPrefix": {
            "type": "string",
            "maxLength": 5
        }        
    },
    "variables": {
        "intranetScope": "[concat('/providers/Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '-internal')]",
        "policyDefinitions": {
            "allowedIntranetResourceTypes": "/providers/Microsoft.Authorization/policyDefinitions/a08ec900-254a-4555-9bf5-e42af04b5c5c",
            "denyIntranetPublicPaaSEndpoints": "[concat('/providers/Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '/providers/Microsoft.Authorization/policySetDefinitions/Deny-PublicEndpoints')]",
            "enforceIntranetSubnetRouteTable": "[concat('/providers/Microsoft.Management/managementGroups/', parameters('topLevelManagementGroupPrefix'), '/providers/Microsoft.Authorization/policyDefinitions/Enforce-Subn-RouteTable')]"
        },
        "policyAssignmentNames": {
            "allowedIntranetResourceTypes": "Allowed-Intra-Resources",
            "denyIntranetPublicPaaSEndpoints": "Deny-Intra-PaaS-Endpoint",
            "enforceIntranetSubnetRouteTable": "Enforce-Intra-RouteTable"
        }
    },
    "resources": [
        {
            "type": "Microsoft.Authorization/policyAssignments",
            "apiVersion": "2018-05-01",
            "name": "[variables('policyAssignmentNames').allowedIntranetResourceTypes]",
            "location": "[deployment().location]",
            "identity": {
                "type": "SystemAssigned"
            },
            "properties": {
                "description": "Allowed-Intra-Resources",
                "displayName": "Allowed-Intra-Resources",
                "policyDefinitionId": "[variables('policyDefinitions').allowedIntranetResourceTypes]",
                "scope": "[variables('intranetScope')]",
                "parameters": {
                    "listOfResourceTypesAllowed": {
                        "value": 
                        [  
                            "microsoft.compute/availabilitySets",
                            "microsoft.compute/virtualMachines",
                            "microsoft.compute/virtualMachines/extensions",
                            "microsoft.compute/virtualMachineScaleSets",
                            "microsoft.compute/virtualMachineScaleSets/extensions",
                            "microsoft.compute/virtualMachineScaleSets/virtualMachines",
                            "microsoft.compute/virtualMachineScaleSets/virtualMachines/extensions",
                            "microsoft.compute/virtualMachineScaleSets/networkInterfaces",
                            "microsoft.compute/virtualMachineScaleSets/virtualMachines/networkInterfaces",
                            "microsoft.compute/operations",
                            "microsoft.compute/restorePointCollections",
                            "microsoft.compute/restorePointCollections/restorePoints",
                            "microsoft.compute/proximityPlacementGroups",
                            "microsoft.compute/sshPublicKeys",
                            "microsoft.compute/locations/spotEvictionRates",
                            "microsoft.compute/locations/spotPriceHistory",
                            "microsoft.compute/sharedVMImages",
                            "microsoft.compute/sharedVMImages/versions",
                            "microsoft.compute/locations/artifactPublishers",
                            "microsoft.compute/locations/capsoperations",
                            "microsoft.compute/galleries",
                            "microsoft.compute/galleries/images",
                            "microsoft.compute/galleries/images/versions",
                            "microsoft.compute/locations/galleries",
                            "microsoft.compute/disks",
                            "microsoft.compute/snapshots",
                            "microsoft.compute/locations/diskoperations",
                            "microsoft.compute/diskEncryptionSets",
                            "microsoft.compute/diskAccesses",
                            "microsoft.compute/images",
                            "microsoft.compute/hostGroups",
                            "microsoft.compute/hostGroups/hosts",
                            "Microsoft.Network/virtualNetworks",
                            "Microsoft.Network/customIpPrefixes",
                            "Microsoft.Network/networkInterfaces",
                            "Microsoft.Network/privateEndpoints",
                            "Microsoft.Network/privateEndpointRedirectMaps",
                            "Microsoft.Network/loadBalancers",
                            "Microsoft.Network/networkSecurityGroups",
                            "Microsoft.Network/applicationSecurityGroups",
                            "Microsoft.Network/serviceEndpointPolicies",
                            "Microsoft.Network/networkIntentPolicies",
                            "Microsoft.Network/routeTables",
                            "Microsoft.Network/ddosCustomPolicies",
                            "Microsoft.Network/networkWatchers",
                            "Microsoft.Network/networkWatchers/connectionMonitors",
                            "Microsoft.Network/networkWatchers/flowLogs",
                            "Microsoft.Network/networkWatchers/pingMeshes",
                            "Microsoft.Network/bastionHosts",
                            "Microsoft.Network/applicationGateways",
                            "Microsoft.Network/applicationGatewayWebApplicationFirewallPolicies",
                            "Microsoft.Network/locations",
                            "Microsoft.Network/locations/operations",
                            "Microsoft.Network/locations/operationResults",
                            "Microsoft.Network/locations/CheckDnsNameAvailability",
                            "Microsoft.Network/locations/setLoadBalancerFrontendPublicIpAddresses",
                            "Microsoft.Network/locations/usages",
                            "Microsoft.Network/locations/virtualNetworkAvailableEndpointServices",
                            "Microsoft.Network/locations/availableDelegations",
                            "Microsoft.Network/locations/serviceTags",
                            "Microsoft.Network/locations/availablePrivateEndpointTypes",
                            "Microsoft.Network/locations/availableServiceAliases",
                            "Microsoft.Network/locations/checkPrivateLinkServiceVisibility",
                            "Microsoft.Network/locations/autoApprovedPrivateLinkServices",
                            "Microsoft.Network/locations/batchValidatePrivateEndpointsForResourceMove",
                            "Microsoft.Network/locations/batchNotifyPrivateEndpointsForResourceMove",
                            "Microsoft.Network/locations/supportedVirtualMachineSizes",
                            "Microsoft.Network/locations/checkAcceleratedNetworkingSupport",
                            "Microsoft.Network/locations/validateResourceOwnership",
                            "Microsoft.Network/locations/setResourceOwnership",
                            "Microsoft.Network/locations/effectiveResourceOwnership",
                            "Microsoft.Network/operations",
                            "Microsoft.Network/dnszones",
                            "Microsoft.Network/dnsOperationResults",
                            "Microsoft.Network/dnsOperationStatuses",
                            "Microsoft.Network/getDnsResourceReference",
                            "Microsoft.Network/internalNotify",
                            "Microsoft.Network/dnszones/A",
                            "Microsoft.Network/dnszones/AAAA",
                            "Microsoft.Network/dnszones/CNAME",
                            "Microsoft.Network/dnszones/PTR",
                            "Microsoft.Network/dnszones/MX",
                            "Microsoft.Network/dnszones/TXT",
                            "Microsoft.Network/dnszones/SRV",
                            "Microsoft.Network/dnszones/SOA",
                            "Microsoft.Network/dnszones/NS",
                            "Microsoft.Network/dnszones/CAA",
                            "Microsoft.Network/dnszones/recordsets",
                            "Microsoft.Network/dnszones/all",
                            "Microsoft.Network/privateDnsZones",
                            "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
                            "Microsoft.Network/privateDnsOperationResults",
                            "Microsoft.Network/privateDnsOperationStatuses",
                            "Microsoft.Network/privateDnsZonesInternal",
                            "Microsoft.Network/privateDnsZones/A",
                            "Microsoft.Network/privateDnsZones/AAAA",
                            "Microsoft.Network/privateDnsZones/CNAME",
                            "Microsoft.Network/privateDnsZones/PTR",
                            "Microsoft.Network/privateDnsZones/MX",
                            "Microsoft.Network/privateDnsZones/TXT",
                            "Microsoft.Network/privateDnsZones/SRV",
                            "Microsoft.Network/privateDnsZones/SOA",
                            "Microsoft.Network/privateDnsZones/all",
                            "Microsoft.Network/virtualNetworks/privateDnsZoneLinks",
                            "Microsoft.Network/routeFilters",
                            "Microsoft.Network/bgpServiceCommunities",
                            "Microsoft.Network/locations/nfvOperations",
                            "Microsoft.Network/locations/nfvOperationResults",
                            "Microsoft.Network/securityPartnerProviders",
                            "Microsoft.Network/firewallPolicies",
                            "Microsoft.Network/ipGroups",
                            "Microsoft.Network/azureFirewalls",
                            "Microsoft.Network/azureFirewallFqdnTags",
                            "Microsoft.Network/applicationGatewayAvailableWafRuleSets",
                            "Microsoft.Network/applicationGatewayAvailableSslOptions",
                            "Microsoft.Network/applicationGatewayAvailableServerVariables",
                            "Microsoft.Network/applicationGatewayAvailableRequestHeaders",
                            "Microsoft.Network/applicationGatewayAvailableResponseHeaders",
                            "Microsoft.Network/virtualNetworkTaps",
                            "Microsoft.Network/privateLinkServices",
                            "Microsoft.Network/locations/privateLinkServices",
                            "Microsoft.Network/ddosProtectionPlans",
                            "Microsoft.Network/networkProfiles",
                            "Microsoft.Network/locations/bareMetalTenants",
                            "Microsoft.Network/virtualWans",
                            "Microsoft.Network/virtualHubs",
                            "Microsoft.Network/networkExperimentProfiles",
                            "Microsoft.RecoveryServices/vaults",
                            "Microsoft.RecoveryServices/operations",
                            "Microsoft.RecoveryServices/locations",
                            "Microsoft.RecoveryServices/locations/backupStatus",
                            "Microsoft.RecoveryServices/locations/checkNameAvailability",
                            "Microsoft.RecoveryServices/locations/backupValidateFeatures",
                            "Microsoft.RecoveryServices/locations/backupPreValidateProtection",
                            "Microsoft.RecoveryServices/locations/allocatedStamp",
                            "Microsoft.RecoveryServices/locations/allocateStamp",
                            "Microsoft.RecoveryServices/locations/backupCrrJobs",
                            "Microsoft.RecoveryServices/locations/backupCrrJob",
                            "Microsoft.RecoveryServices/locations/backupAadProperties",
                            "Microsoft.RecoveryServices/locations/backupCrossRegionRestore",
                            "Microsoft.RecoveryServices/locations/backupCrrOperationResults",
                            "Microsoft.RecoveryServices/locations/backupCrrOperationsStatus",
                            "Microsoft.RecoveryServices/backupProtectedItems",
                            "Microsoft.RecoveryServices/replicationEligibilityResults",
                            "Microsoft.Storage/deletedAccounts",
                            "Microsoft.Storage/locations/deletedAccounts",
                            "Microsoft.Storage/storageAccounts",
                            "Microsoft.Storage/storageAccounts/listAccountSas",
                            "Microsoft.Storage/storageAccounts/listServiceSas",
                            "Microsoft.Storage/operations",
                            "Microsoft.Storage/usages",
                            "Microsoft.Storage/checkNameAvailability",
                            "Microsoft.Storage/locations/checkNameAvailability",
                            "Microsoft.Storage/locations",
                            "Microsoft.Storage/locations/asyncoperations",
                            "Microsoft.Storage/locations/usages",
                            "Microsoft.Storage/locations/deleteVirtualNetworkOrSubnets",
                            "Microsoft.Storage/storageAccounts/blobServices",
                            "Microsoft.Storage/storageAccounts/tableServices",
                            "Microsoft.Storage/storageAccounts/queueServices",
                            "Microsoft.Storage/storageAccounts/fileServices",
                            "Microsoft.DocumentDB/databaseAccounts",
                            "Microsoft.DocumentDB/databaseAccountNames",
                            "Microsoft.DocumentDB/operations",
                            "Microsoft.DocumentDB/operationResults",
                            "Microsoft.DocumentDB/locations",
                            "Microsoft.DocumentDB/locations/operationsStatus",
                            "Microsoft.DocumentDB/locations/operationResults",
                            "Microsoft.DocumentDB/locations/deleteVirtualNetworkOrSubnets",
                            "Microsoft.DocumentDB/locations/restorableDatabaseAccounts",
                            "Microsoft.DocumentDB/restorableDatabaseAccounts",
                            "Microsoft.DBforMariaDB/operations",
                            "Microsoft.DBforMariaDB/servers",
                            "Microsoft.DBforMariaDB/servers/recoverableServers",
                            "Microsoft.DBforMariaDB/servers/virtualNetworkRules",
                            "Microsoft.DBforMariaDB/checkNameAvailability",
                            "Microsoft.DBforMariaDB/locations",
                            "Microsoft.DBforMariaDB/locations/operationResults",
                            "Microsoft.DBforMariaDB/locations/azureAsyncOperation",
                            "Microsoft.DBforMariaDB/locations/performanceTiers",
                            "Microsoft.DBforMariaDB/locations/serverKeyAzureAsyncOperation",
                            "Microsoft.DBforMariaDB/locations/serverKeyOperationResults",
                            "Microsoft.DBforMariaDB/servers/topQueryStatistics",
                            "Microsoft.DBforMariaDB/servers/queryTexts",
                            "Microsoft.DBforMariaDB/servers/waitStatistics",
                            "Microsoft.DBforMariaDB/servers/advisors",
                            "Microsoft.DBforMariaDB/locations/securityAlertPoliciesAzureAsyncOperation",
                            "Microsoft.DBforMariaDB/locations/securityAlertPoliciesOperationResults",
                            "Microsoft.DBforMariaDB/locations/recommendedActionSessionsAzureAsyncOperation",
                            "Microsoft.DBforMariaDB/locations/recommendedActionSessionsOperationResults",
                            "Microsoft.DBforMariaDB/locations/privateEndpointConnectionProxyOperationResults",
                            "Microsoft.DBforMariaDB/locations/privateEndpointConnectionProxyAzureAsyncOperation",
                            "Microsoft.DBforMariaDB/locations/privateEndpointConnectionOperationResults",
                            "Microsoft.DBforMariaDB/locations/privateEndpointConnectionAzureAsyncOperation",
                            "Microsoft.DBforMariaDB/servers/privateLinkResources",
                            "Microsoft.DBforMariaDB/servers/privateEndpointConnections",
                            "Microsoft.DBforMariaDB/servers/privateEndpointConnectionProxies",
                            "Microsoft.DBforMySQL/operations",
                            "Microsoft.DBforMySQL/servers",
                            "Microsoft.DBforMySQL/servers/recoverableServers",
                            "Microsoft.DBforMySQL/servers/virtualNetworkRules",
                            "Microsoft.DBforMySQL/checkNameAvailability",
                            "Microsoft.DBforMySQL/locations",
                            "Microsoft.DBforMySQL/locations/operationResults",
                            "Microsoft.DBforMySQL/locations/azureAsyncOperation",
                            "Microsoft.DBforMySQL/locations/administratorOperationResults",
                            "Microsoft.DBforMySQL/locations/administratorAzureAsyncOperation",
                            "Microsoft.DBforMySQL/locations/performanceTiers",
                            "Microsoft.DBforMySQL/servers/keys",
                            "Microsoft.DBforMySQL/locations/serverKeyAzureAsyncOperation",
                            "Microsoft.DBforMySQL/locations/serverKeyOperationResults",
                            "Microsoft.DBforMySQL/servers/topQueryStatistics",
                            "Microsoft.DBforMySQL/servers/queryTexts",
                            "Microsoft.DBforMySQL/servers/waitStatistics",
                            "Microsoft.DBforMySQL/servers/advisors",
                            "Microsoft.DBforMySQL/locations/securityAlertPoliciesAzureAsyncOperation",
                            "Microsoft.DBforMySQL/locations/securityAlertPoliciesOperationResults",
                            "Microsoft.DBforMySQL/locations/recommendedActionSessionsAzureAsyncOperation",
                            "Microsoft.DBforMySQL/locations/recommendedActionSessionsOperationResults",
                            "Microsoft.DBforMySQL/locations/privateEndpointConnectionProxyOperationResults",
                            "Microsoft.DBforMySQL/locations/privateEndpointConnectionProxyAzureAsyncOperation",
                            "Microsoft.DBforMySQL/locations/privateEndpointConnectionOperationResults",
                            "Microsoft.DBforMySQL/locations/privateEndpointConnectionAzureAsyncOperation",
                            "Microsoft.DBforMySQL/servers/privateLinkResources",
                            "Microsoft.DBforMySQL/servers/privateEndpointConnections",
                            "Microsoft.DBforMySQL/servers/privateEndpointConnectionProxies",
                            "Microsoft.DBforMySQL/servers/start",
                            "Microsoft.DBforMySQL/servers/stop",
                            "Microsoft.DBforMySQL/servers/upgrade",
                            "Microsoft.DBforPostgreSQL/operations",
                            "Microsoft.DBforPostgreSQL/servers",
                            "Microsoft.DBforPostgreSQL/servers/recoverableServers",
                            "Microsoft.DBforPostgreSQL/servers/virtualNetworkRules",
                            "Microsoft.DBforPostgreSQL/checkNameAvailability",
                            "Microsoft.DBforPostgreSQL/locations",
                            "Microsoft.DBforPostgreSQL/locations/operationResults",
                            "Microsoft.DBforPostgreSQL/locations/azureAsyncOperation",
                            "Microsoft.DBforPostgreSQL/locations/administratorOperationResults",
                            "Microsoft.DBforPostgreSQL/locations/administratorAzureAsyncOperation",
                            "Microsoft.DBforPostgreSQL/locations/performanceTiers",
                            "Microsoft.DBforPostgreSQL/locations/securityAlertPoliciesAzureAsyncOperation",
                            "Microsoft.DBforPostgreSQL/locations/securityAlertPoliciesOperationResults",
                            "Microsoft.DBforPostgreSQL/locations/recommendedActionSessionsAzureAsyncOperation",
                            "Microsoft.DBforPostgreSQL/locations/recommendedActionSessionsOperationResults",
                            "Microsoft.DBforPostgreSQL/servers/topQueryStatistics",
                            "Microsoft.DBforPostgreSQL/servers/queryTexts",
                            "Microsoft.DBforPostgreSQL/servers/waitStatistics",
                            "Microsoft.DBforPostgreSQL/servers/advisors",
                            "Microsoft.DBforPostgreSQL/servers/keys",
                            "Microsoft.DBforPostgreSQL/locations/serverKeyAzureAsyncOperation",
                            "Microsoft.DBforPostgreSQL/locations/serverKeyOperationResults",
                            "Microsoft.DBforPostgreSQL/locations/privateEndpointConnectionProxyOperationResults",
                            "Microsoft.DBforPostgreSQL/locations/privateEndpointConnectionProxyAzureAsyncOperation",
                            "Microsoft.DBforPostgreSQL/locations/privateEndpointConnectionOperationResults",
                            "Microsoft.DBforPostgreSQL/locations/privateEndpointConnectionAzureAsyncOperation",
                            "Microsoft.DBforPostgreSQL/servers/privateLinkResources",
                            "Microsoft.DBforPostgreSQL/servers/privateEndpointConnections",
                            "Microsoft.DBforPostgreSQL/servers/privateEndpointConnectionProxies",
                            "Microsoft.KeyVault/vaults",
                            "Microsoft.KeyVault/vaults/secrets",
                            "Microsoft.KeyVault/vaults/accessPolicies",
                            "Microsoft.KeyVault/operations",
                            "Microsoft.KeyVault/checkNameAvailability",
                            "Microsoft.KeyVault/deletedVaults",
                            "Microsoft.KeyVault/locations/deleteVirtualNetworkOrSubnets",
                            "Microsoft.KeyVault/locations",
                            "Microsoft.KeyVault/locations/deletedVaults",
                            "Microsoft.KeyVault/locations/operationResults",
                            "Microsoft.KeyVault/vaults/eventGridFilters",
                            "Microsoft.KeyVault/vaults/keys",
                            "Microsoft.KeyVault/vaults/keys/versions",
                            "Microsoft.Web/serverFarms/firstPartyApps/keyVaultSettings",
                            "Microsoft.Sql/operations",
                            "Microsoft.Sql/locations",
                            "Microsoft.Sql/locations/capabilities",
                            "Microsoft.Sql/locations/databaseAzureAsyncOperation",
                            "Microsoft.Sql/locations/databaseOperationResults",
                            "Microsoft.Sql/locations/databaseRestoreAzureAsyncOperation",
                            "Microsoft.Sql/locations/usages",
                            "Microsoft.Sql/checkNameAvailability",
                            "Microsoft.Sql/servers",
                            "Microsoft.Sql/servers/databases",
                            "Microsoft.Sql/servers/serviceObjectives",
                            "Microsoft.Sql/servers/communicationLinks",
                            "Microsoft.Sql/servers/administrators",
                            "Microsoft.Sql/servers/administratorOperationResults",
                            "Microsoft.Sql/locations/serverAdministratorAzureAsyncOperation",
                            "Microsoft.Sql/locations/serverAdministratorOperationResults",
                            "Microsoft.Sql/servers/restorableDroppedDatabases",
                            "Microsoft.Sql/servers/recoverableDatabases",
                            "Microsoft.Sql/servers/databases/geoBackupPolicies",
                            "Microsoft.Sql/servers/import",
                            "Microsoft.Sql/servers/importExportOperationResults",
                            "Microsoft.Sql/servers/operationResults",
                            "Microsoft.Sql/servers/databaseSecurityPolicies",
                            "Microsoft.Sql/servers/recommendedElasticPools",
                            "Microsoft.Sql/servers/automaticTuning",
                            "Microsoft.Sql/servers/databases/automaticTuning",
                            "Microsoft.Sql/locations/serverKeyAzureAsyncOperation",
                            "Microsoft.Sql/locations/serverKeyOperationResults",
                            "Microsoft.Sql/servers/keys",
                            "Microsoft.Sql/servers/encryptionProtector",
                            "Microsoft.Sql/locations/encryptionProtectorOperationResults",
                            "Microsoft.Sql/locations/encryptionProtectorAzureAsyncOperation",
                            "Microsoft.Sql/servers/databases/transparentDataEncryption",
                            "Microsoft.Sql/servers/databases/backupShortTermRetentionPolicies",
                            "Microsoft.Sql/servers/databases/backupLongTermRetentionPolicies",
                            "Microsoft.Sql/locations/longTermRetentionServers",
                            "Microsoft.Sql/locations/longTermRetentionBackups",
                            "Microsoft.Sql/locations/longTermRetentionPolicyOperationResults",
                            "Microsoft.Sql/locations/longTermRetentionPolicyAzureAsyncOperation",
                            "Microsoft.Sql/locations/longTermRetentionBackupOperationResults",
                            "Microsoft.Sql/locations/longTermRetentionBackupAzureAsyncOperation",
                            "Microsoft.Sql/locations/shortTermRetentionPolicyOperationResults",
                            "Microsoft.Sql/locations/shortTermRetentionPolicyAzureAsyncOperation",
                            "Microsoft.Sql/servers/databases/dataMaskingPolicies",
                            "Microsoft.Sql/servers/databases/dataMaskingPolicies/rules",
                            "Microsoft.Sql/servers/databases/securityAlertPolicies",
                            "Microsoft.Sql/servers/securityAlertPolicies",
                            "Microsoft.Sql/servers/databases/auditingSettings",
                            "Microsoft.Sql/servers/auditingSettings",
                            "Microsoft.Sql/servers/devOpsAuditingSettings",
                            "Microsoft.Sql/servers/extendedAuditingSettings",
                            "Microsoft.Sql/locations/auditingSettingsAzureAsyncOperation",
                            "Microsoft.Sql/locations/auditingSettingsOperationResults",
                            "Microsoft.Sql/locations/devOpsAuditingSettingsAzureAsyncOperation",
                            "Microsoft.Sql/locations/devOpsAuditingSettingsOperationResults",
                            "Microsoft.Sql/locations/extendedAuditingSettingsAzureAsyncOperation",
                            "Microsoft.Sql/locations/extendedAuditingSettingsOperationResults",
                            "Microsoft.Sql/locations/elasticPoolAzureAsyncOperation",
                            "Microsoft.Sql/locations/elasticPoolOperationResults",
                            "Microsoft.Sql/servers/elasticpools",
                            "Microsoft.Sql/servers/jobAgents",
                            "Microsoft.Sql/locations/jobAgentOperationResults",
                            "Microsoft.Sql/locations/jobAgentAzureAsyncOperation",
                            "Microsoft.Sql/servers/jobAgents/jobs",
                            "Microsoft.Sql/servers/jobAgents/jobs/steps",
                            "Microsoft.Sql/servers/jobAgents/jobs/executions",
                            "Microsoft.Sql/servers/disasterRecoveryConfiguration",
                            "Microsoft.Sql/servers/dnsAliases",
                            "Microsoft.Sql/locations/dnsAliasAsyncOperation",
                            "Microsoft.Sql/locations/dnsAliasOperationResults",
                            "Microsoft.Sql/servers/failoverGroups",
                            "Microsoft.Sql/locations/failoverGroupAzureAsyncOperation",
                            "Microsoft.Sql/locations/failoverGroupOperationResults",
                            "Microsoft.Sql/locations/firewallRulesOperationResults",
                            "Microsoft.Sql/locations/firewallRulesAzureAsyncOperation",
                            "Microsoft.Sql/locations/deleteVirtualNetworkOrSubnets",
                            "Microsoft.Sql/servers/virtualNetworkRules",
                            "Microsoft.Sql/locations/virtualNetworkRulesOperationResults",
                            "Microsoft.Sql/locations/virtualNetworkRulesAzureAsyncOperation",
                            "Microsoft.Sql/locations/deleteVirtualNetworkOrSubnetsOperationResults",
                            "Microsoft.Sql/locations/deleteVirtualNetworkOrSubnetsAzureAsyncOperation",
                            "Microsoft.Sql/locations/serverAzureAsyncOperation",
                            "Microsoft.Sql/locations/serverOperationResults",
                            "Microsoft.Sql/servers/usages",
                            "Microsoft.Sql/servers/databases/metricDefinitions",
                            "Microsoft.Sql/servers/databases/metrics",
                            "Microsoft.Sql/servers/aggregatedDatabaseMetrics",
                            "Microsoft.Sql/servers/elasticpools/metrics",
                            "Microsoft.Sql/servers/elasticpools/metricdefinitions",
                            "Microsoft.Sql/servers/databases/topQueries",
                            "Microsoft.Sql/servers/databases/topQueries/queryText",
                            "Microsoft.Sql/servers/advisors",
                            "Microsoft.Sql/servers/elasticPools/advisors",
                            "Microsoft.Sql/servers/databases/advisors",
                            "Microsoft.Sql/servers/databases/extensions",
                            "Microsoft.Sql/servers/elasticPoolEstimates",
                            "Microsoft.Sql/servers/databases/auditRecords",
                            "Microsoft.Sql/servers/databases/VulnerabilityAssessmentScans",
                            "Microsoft.Sql/servers/databases/workloadGroups",
                            "Microsoft.Sql/servers/databases/vulnerabilityAssessments",
                            "Microsoft.Sql/servers/vulnerabilityAssessments",
                            "Microsoft.Sql/servers/databases/VulnerabilityAssessmentSettings",
                            "Microsoft.Sql/servers/databases/VulnerabilityAssessment",
                            "Microsoft.Sql/locations/vulnerabilityAssessmentScanAzureAsyncOperation",
                            "Microsoft.Sql/locations/vulnerabilityAssessmentScanOperationResults",
                            "Microsoft.Sql/servers/databases/recommendedSensitivityLabels",
                            "Microsoft.Sql/servers/databases/syncGroups",
                            "Microsoft.Sql/servers/databases/syncGroups/syncMembers",
                            "Microsoft.Sql/servers/syncAgents",
                            "Microsoft.Sql/locations/syncGroupOperationResults",
                            "Microsoft.Sql/locations/syncMemberOperationResults",
                            "Microsoft.Sql/locations/syncAgentOperationResults",
                            "Microsoft.Sql/servers/tdeCertificates",
                            "Microsoft.Sql/locations/tdeCertAzureAsyncOperation",
                            "Microsoft.Sql/locations/tdeCertOperationResults",
                            "Microsoft.Sql/locations/syncDatabaseIds",
                            "Microsoft.Sql/locations/securityAlertPoliciesAzureAsyncOperation",
                            "Microsoft.Sql/locations/securityAlertPoliciesOperationResults",
                            "Microsoft.Sql/virtualClusters",
                            "Microsoft.Sql/locations/virtualClusterAzureAsyncOperation",
                            "Microsoft.Sql/locations/virtualClusterOperationResults",
                            "Microsoft.Sql/locations/importExportOperationResults",
                            "Microsoft.Sql/locations/importExportAzureAsyncOperation",
                            "Microsoft.Sql/managedInstances",
                            "Microsoft.Sql/locations/managedInstanceAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedInstanceOperationResults",
                            "Microsoft.Sql/locations/administratorAzureAsyncOperation",
                            "Microsoft.Sql/locations/administratorOperationResults",
                            "Microsoft.Sql/managedInstances/databases",
                            "Microsoft.Sql/managedInstances/recoverableDatabases",
                            "Microsoft.Sql/managedInstances/databases/backupLongTermRetentionPolicies",
                            "Microsoft.Sql/managedInstances/sqlAgent",
                            "Microsoft.Sql/locations/managedInstancePrivateEndpointConnectionProxyOperationResults",
                            "Microsoft.Sql/locations/managedInstancePrivateEndpointConnectionProxyAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedInstancePrivateEndpointConnectionOperationResults",
                            "Microsoft.Sql/locations/managedInstancePrivateEndpointConnectionAzureAsyncOperation",
                            "Microsoft.Sql/locations/longTermRetentionManagedInstances",
                            "Microsoft.Sql/locations/longTermRetentionManagedInstanceBackups",
                            "Microsoft.Sql/locations/managedInstanceLongTermRetentionPolicyOperationResults",
                            "Microsoft.Sql/locations/managedInstanceLongTermRetentionPolicyAzureAsyncOperation",
                            "Microsoft.Sql/locations/longTermRetentionManagedInstanceBackupOperationResults",
                            "Microsoft.Sql/locations/longTermRetentionManagedInstanceBackupAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedDatabaseAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedDatabaseOperationResults",
                            "Microsoft.Sql/locations/managedDatabaseRestoreAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedDatabaseRestoreOperationResults",
                            "Microsoft.Sql/locations/managedDatabaseCompleteRestoreAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedDatabaseCompleteRestoreOperationResults",
                            "Microsoft.Sql/locations/instanceFailoverGroups",
                            "Microsoft.Sql/locations/instanceFailoverGroupAzureAsyncOperation",
                            "Microsoft.Sql/locations/instanceFailoverGroupOperationResults",
                            "Microsoft.Sql/locations/privateEndpointConnectionProxyOperationResults",
                            "Microsoft.Sql/locations/privateEndpointConnectionProxyAzureAsyncOperation",
                            "Microsoft.Sql/locations/privateEndpointConnectionOperationResults",
                            "Microsoft.Sql/locations/privateEndpointConnectionAzureAsyncOperation",
                            "Microsoft.Sql/managedInstances/tdeCertificates",
                            "Microsoft.Sql/locations/managedInstanceTdeCertAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedInstanceTdeCertOperationResults",
                            "Microsoft.Sql/managedInstances/metricDefinitions",
                            "Microsoft.Sql/managedInstances/metrics",
                            "Microsoft.Sql/managedInstances/vulnerabilityAssessments",
                            "Microsoft.Sql/managedInstances/databases/vulnerabilityAssessments",
                            "Microsoft.Sql/managedInstances/administrators",
                            "Microsoft.Sql/locations/managedInstanceEncryptionProtectorOperationResults",
                            "Microsoft.Sql/locations/managedInstanceEncryptionProtectorAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedInstanceKeyAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedInstanceKeyOperationResults",
                            "Microsoft.Sql/locations/managedShortTermRetentionPolicyOperationResults",
                            "Microsoft.Sql/locations/managedShortTermRetentionPolicyAzureAsyncOperation",
                            "Microsoft.Sql/locations/managedServerSecurityAlertPoliciesOperationResults",
                            "Microsoft.Sql/locations/managedServerSecurityAlertPoliciesAzureAsyncOperation",
                            "Microsoft.Sql/locations/notifyAzureAsyncOperation",
                            "Microsoft.Sql/locations/serverTrustGroups",
                            "Microsoft.Sql/locations/serverTrustGroupOperationResults",
                            "Microsoft.Sql/locations/serverTrustGroupAzureAsyncOperation",
                            "Microsoft.SqlVirtualMachine/SqlVirtualMachineGroups",
                            "Microsoft.SqlVirtualMachine/SqlVirtualMachines",
                            "Microsoft.SqlVirtualMachine/SqlVirtualMachineGroups/AvailabilityGroupListeners",
                            "Microsoft.SqlVirtualMachine/operations",
                            "Microsoft.SqlVirtualMachine/Locations",
                            "Microsoft.SqlVirtualMachine/Locations/OperationTypes",
                            "Microsoft.SqlVirtualMachine/Locations/sqlVirtualMachineOperationResults",
                            "Microsoft.SqlVirtualMachine/Locations/sqlVirtualMachineGroupOperationResults",
                            "Microsoft.SqlVirtualMachine/Locations/availabilityGroupListenerOperationResults",
                            "Microsoft.SqlVirtualMachine/Locations/registerSqlVmCandidate",
                            "Microsoft.ContainerService/managedClusters",
                            "Microsoft.ContainerService/locations",
                            "Microsoft.ContainerService/locations/operationresults",
                            "Microsoft.ContainerService/locations/operations",
                            "Microsoft.ContainerService/operations",
                            "Microsoft.ContainerService/locations/orchestrators"
                        ]
                    }
                }
            }
        },
        {
            "type": "Microsoft.Authorization/policyAssignments",
            "apiVersion": "2018-05-01",
            "name": "[variables('policyAssignmentNames').denyIntranetPublicPaaSEndpoints]",
            "location": "[deployment().location]",
            "identity": {
                "type": "SystemAssigned"
            },
            "properties": {
                "description": "Deny-Intra-PaaS-Endpoint",
                "displayName": "Deny-Intra-PaaS-Endpoint",
                "policyDefinitionId": "[variables('policyDefinitions').denyIntranetPublicPaaSEndpoints]",
                "scope": "[variables('intranetScope')]",
                "parameters": {
                    "CosmosPublicIpDenyEffect": {
                        "value": "Deny"
                    },
                    "MariaDBPublicIpDenyEffect": {
                        "value": "Deny"
                    },
                    "MySQLPublicIpDenyEffect": {
                        "value": "Deny"
                    },
                    "PostgreSQLPublicIpDenyEffect": {
                        "value": "Deny"
                    },
                    "KeyVaultPublicIpDenyEffect": {
                        "value": "Deny"
                    },
                    "SqlServerPublicIpDenyEffect": {
                        "value": "Deny"
                    },
                    "StoragePublicIpDenyEffect": {
                        "value": "Deny"
                    },
                    "AKSPublicIpDenyEffect": {
                        "value": "Deny"
                    }
                }
            }
        },
        {
            "type": "Microsoft.Authorization/policyAssignments",
            "apiVersion": "2018-05-01",
            "name": "[variables('policyAssignmentNames').enforceIntranetSubnetRouteTable]",
            "location": "[deployment().location]",
            "identity": {
                "type": "SystemAssigned"
            },
            "properties": {
                "description": "Enforce-Intra-RouteTable",
                "displayName": "Enforce-Intra-RouteTable",
                "policyDefinitionId": "[variables('policyDefinitions').enforceIntranetSubnetRouteTable]",
                "scope": "[variables('intranetScope')]",
                "parameters": {
                    "routeTableResourceGroup": {
                        "value": "Locked"
                    },
                    "routeTableName": {
                        "value": "RouteTable"
                    }
                }
            }
        }
    ],
    "outputs": {}
}